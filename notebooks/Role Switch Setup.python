{"version":"NotebookV1","origId":1342094670899166,"name":"Role Switch Setup","language":"python","commands":[{"version":"CommandV1","origId":1501600681754807,"guid":"8dd8bb7f-5fed-4fc3-91c4-427551018b15","subtype":"command","commandType":"auto","position":2.0,"command":"%pip install --quiet databricks-sdk==0.25.1","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"93430d2a-2edb-4dea-aa92-1c6f4805d4cd"},{"version":"CommandV1","origId":1501600681754808,"guid":"78594ed0-aa78-4e28-9465-582ecedb9e5f","subtype":"command","commandType":"auto","position":3.0,"command":"dbutils.library.restartPython()","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d61ea6b9-e098-44a1-8cea-74b2652d5ed4"},{"version":"CommandV1","origId":1501600681754809,"guid":"9f71033b-27c8-4a9a-a92c-748777f75452","subtype":"command","commandType":"auto","position":4.0,"command":"import ipywidgets as widgets\nfrom ipywidgets import interactive\nfrom dbx.ucrolehelper import UCRoleHelper\nfrom dbx.ucrolehelper import version as ucrolehelper_version\nfrom dbx.ucrolehelper import UCRHConfig\nfrom databricks.sdk import version as databricks_sdk_version\nimport logging\nlogging.basicConfig(level=logging.WARN)\n\nlogging.info(f'dbx.ucrolehelper version: {ucrolehelper_version.__version__}')\nlogging.info(f'databricks_sdk          version: {databricks_sdk_version.__version__}')","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"02e23921-944b-4fa8-a63e-e93d91e13548"},{"version":"CommandV1","origId":1501600681754810,"guid":"b14e30d8-8d85-4612-afd7-5c62c937c8c4","subtype":"command","commandType":"auto","position":5.0,"command":"config = UCRHConfig().get_config()\nroles = config.get('roles')\n\nucrh = UCRoleHelper(config=config, roles=roles, assume_username=None, dbutils=dbutils)\n\ndefault_role = ''\ncurrent_role = default_role\nroles.append(default_role)\n\n#DropDown\n\ndef do_switch(new_role:str):\n    print(f'New role {new_role} ... clearing cached data.')\n    spark.sql(\"CLEAR CACHE\")\n    ucrh.switch_role(new_role = new_role)\n    print(ucrh.get_current_user_roles())\n\ndef pickRole():\n    options = roles\n    roleSelect=widgets.Dropdown(\n        options=roles,\n        value=current_role,\n        description='Role:',\n    )\n    \n    output_role = widgets.Output()\n    display(roleSelect,output_role)\n    def on_value_change(change):\n        with output_role:\n            do_switch(new_role=roleSelect.value)\n\n    roleSelect.observe(on_value_change, names='value')","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2f142dc0-f9bb-4b6a-a38f-eafdbef0df04"}],"dashboards":[],"guid":"7027c418-6589-439b-bb76-ffe75cf55024","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{},"reposExportFormat":"SOURCE","environmentMetadata":null}